package edu.zju.gis.vectortile;

import org.junit.Test;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.concurrent.atomic.AtomicInteger;

public class CommonTest {
    @Test
    public void testInsert() throws SQLException, IOException {
        String url = "jdbc:oracle:thin:@//172.20.3.240:1521/orcl"; //URL地址
        String username = "ssjt";
        String password = "ssjt";
        Connection conn = DriverManager.getConnection(url, username, password);
        Statement stat = conn.createStatement();
        AtomicInteger counter = new AtomicInteger(0);
        Files.lines(Paths.get("E:\\pbfxyz.sql")).forEach(sql -> {
            try {
                if (sql.endsWith(";"))
                    sql = sql.substring(0, sql.length() - 1);
                if (sql.length() > 4000) {
                    String[] values = sql.substring(sql.indexOf("(") + 1, sql.indexOf(")")).split("', '");
                    values[0] = values[0].replace("'", "");
                    values[1] = values[1].replace("'", "");
                    sql = String.format("declare vb clob:= '%s';begin INSERT INTO \"TILE_MAP_2019\" VALUES('%s',vb);end;", values[1], values[0]);
                }
                stat.execute(sql);
            } catch (SQLException e) {
                e.printStackTrace();
                counter.addAndGet(1);
            }
        });
        System.out.println(counter.get());
    }

    @Test
    public void testOracle() throws SQLException {
        String url = "jdbc:oracle:thin:@//172.20.3.240:1521/orcl"; //URL地址
        String username = "ssjt";
        String password = "ssjt";
        Connection conn = DriverManager.getConnection(url, username, password);
        Statement stat = conn.createStatement();
        stat.execute("declare vb clob:= '8047,8048,8049,8050,8051,8052,8053,8054,8055,8056,8057,8058,8059,8060,8079,8217,8218,10708,10709,10710,10711,10714,10715,10719,10720,10721,10722,10723,10724,10725,10738,10739,11288,11289,11290,11291,11296,11297,11298,11299,11302,11425,11427,11428,11429,11430,11431,11432,11433,11442,11443,11974,11975,11976,11977,11978,11981,11982,11983,11984,12127,12130,12134,12137,12139,12140,12142,12145,12148,12151,12856,12857,12860,12861,12862,12863,12865,12866,12867,12869,12870,12871,12872,12875,12876,12877,12878,13425,13426,13427,13428,13429,13434,13435,13436,13437,13438,13439,13440,14822,14823,14824,14825,14903,14904,14905,14906,25039,28016,28017,28018,28019,28565,28566,28567,28568,28569,28570,28571,28572,28581,28582,28583,28584,28589,28590,29103,29104,29105,29106,29107,29108,29109,29110,29300,29303,30157,30158,30159,30160,30164,30165,30166,30167,37276,37277,37278,38003,38004,38005,38143,38230,38231,38232,38233,38234,38568,38569,38570,38571,38572,38575,38585,38588,38589,38590,38726,38727,38728,38729,38730,38731,38732,38733,38734,38735,38736,38737,38738,41317,41574,41575,41576,41577,41578,41579,41580,41581,41582,41589,41590,41591,41592,41597,41726,42148,42149,42150,42151,42152,43934,43935,43936,43937,44078,44079,44633,44634,91215,117627,168116,168117,168118,168119,168128,168129,168251,168252,168253,168254,168255,168256,168257,168258,168259,168260,168261,168262,168263,168802,168805,168806,168807,168808,168809,168810,168811,168814,168953,168959,168960,168968,168969,168970,168971,168972,168973,168974,168975,168976,168977,168978,168979,169514,169515,169516,169517,169522,169523,169524,169525,169526,169527,169686,169687,169688,169689,170223,170224,170225,170226,170227,170228,170229,170230,170235,170236,170237,170238,170239,170240,170241,170242,170350,170351,170363,170364,170365,170366,170367,170389,170390,170391,170393,170394,170395,170396,177761,177762,177763,177764,207563,207564,207567,207568,211073,211074,212171,212172,212176,212177,224357,224358,224359,224360,224363,224364,224365,224366,224367,224368,224369,224370,224371,224372,224751,224752,224753,224754,224925,224926,224927,224928,224929,224930,224931,224932,224933,224934,224935,224936,224937,224938,224939,224940,224941,224942,224943,224944,225091,225092,225093,225094,225095,225096,225097,225098,225099,225100,225101,225102,225477,225478,225479,225480,225481,225482,225483,225484,225485,225486,225487,225488,225489,225490,225491,225492,225493,225494,225632,225633,225634,225635,225636,225637,225638,226718,226719,226724,226725,226727,226728,226730,226731,226877,226878,226914,226915,226916,226917,227516,227701,227702,227703,227704,227705,227706,228611,228612,228613,228614,228627,228628,228634,228635,228636,228639,228640,228641,228787,228788,228789,228790,228791,228792,228793,228794,228795,228796,248474,248475,248476,248477,248977,255898,255899,255900,255901,269721,269722,269913,269949,269958,270048,270066,270085,270288,270289,270386,270632,271026,271043,271044,271045,271047,271102,271106,271107,271273,271276,271277,272752,272754,272756,272758,272778,272913,272915,272916,273454,275446,275448,275449,276068,276069,276070,276071,276076,276077,276991,276992,276993,276994,277015,277016,278371,278372,278381,278382,278383,278384,278385,278386,278387,278388,278389,278390,278391,278392,278393,278394,278395,278396,278397,278398,278401,278532,278533,278534,279002,279003,279927,279928,279929,279930,279931,279932,279933,279934,279935,279936,280262,280264,280265,280642,280643,280644,280645,280646,280647,280648,280649,280810,280811,280814,280815,280818,280819,280820,280821,280822,280823,280876,280879,280923,280924,280925,280926,280929,280931,281751,281752,281753,281759,281770,281771,281772,281811,281813,281814,281815,281822,281823,281959,281960,281961,281962,282128,282129,282130,282131,282638,282639,282640,282641,282968,282969,282970,282971,283171,283172,283173,283704,283705,283706,283714,283715,283717,283718,283719,283720,283721,283722,284811,284814,284815,284995,284996,285419,285422,285547,285682,285683,285684,285685,285686,285688,286005,286006,286009,289172,289173,290582,290583,290584,290593,290594,290595,290596,290597,291035,291036,294015,294964,295852,295853,295863,295864,295869,295870,295872,295873,295874,295875,295883,295943,295944,295945,295946,295947,295949,295950,296062,296063,296064,297206,297207,342727,342728,342729,342730,357326,357327,357328,357329,387109,387110,387111,387113,387119,387120,387121,399790,399791,399792,399793,928409,928412';begin INSERT INTO \"TILE_MAP_2019\" VALUES('11_3374_1426',vb); end;");
    }
}
